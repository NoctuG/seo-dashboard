import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';

const LANGUAGE_STORAGE_KEY = 'seo.ui.language';
const fallbackLng = 'zh-CN';
const saved = localStorage.getItem(LANGUAGE_STORAGE_KEY);
const browser = navigator.language || fallbackLng;
const initialLng = saved || browser;

const resources = {
  'en-US': {
    translation: {
      common: {
        loading: 'Loading...',
        create: 'Create',
        cancel: 'Cancel',
        delete: 'Delete',
        yes: 'Yes',
        no: 'No',
      },
      app: { loading: 'Loading...' },
      layout: {
        title: 'SEO Tool',
        projects: 'Projects',
        aiAssistant: 'AI Assistant',
        aiContent: 'AI Content',
        users: 'Users',
        systemSettings: 'System Settings',
        changePassword: 'Change Password',
        twoFactorAuth: 'Two-Factor Auth',
        logout: 'Sign out',
        language: 'Language',
        theme: 'Theme',
        langZhCN: '简体中文',
        langEnUS: 'English',
      },
      login: {
        title: 'Sign in to SEO Dashboard',
        email: 'Email',
        password: 'Password',
        submit: 'Sign in',
        loading: 'Signing in...',
        forgotPassword: 'Forgot password?',
        errors: { failed: 'Login failed. Please check email and password.' },
      },
      forgotPassword: {
        title: 'Forgot password',
        email: 'Email',
        submit: 'Send reset link',
        loading: 'Sending...',
        backToLogin: 'Back to sign in',
        errors: { failed: 'Failed to send reset email. Please try again later.' },
      },
      resetPassword: {
        title: 'Reset password',
        token: 'Reset token',
        newPassword: 'New password',
        confirmPassword: 'Confirm new password',
        submit: 'Reset password',
        loading: 'Submitting...',
        backToLogin: 'Back to sign in',
        errors: {
          missingToken: 'Missing reset token.',
          passwordMismatch: 'New passwords do not match.',
          failed: 'Failed to reset password. Token may be expired.',
        },
      },
      changePassword: {
        title: 'Change password',
        oldPassword: 'Current password',
        newPassword: 'New password',
        confirmPassword: 'Confirm new password',
        submit: 'Update password',
        loading: 'Submitting...',
        errors: {
          passwordMismatch: 'New passwords do not match.',
          failed: 'Failed to change password. Please check current password.',
        },
      },
      projects: {
        title: 'Projects',
        newProject: 'New Project',
        createProject: 'Create Project',
        name: 'Name',
        domain: 'Domain',
        createdAt: 'Created {{date}}',
      },
      users: {
        title: 'User Management',
        createUser: 'Create User',
        email: 'Email',
        fullName: 'Full Name',
        name: 'Name',
        password: 'Password',
        active: 'Active',
        superuser: 'Superuser',
        actions: 'Actions',
        toggleActive: 'Toggle Active',
        toggleAdmin: 'Toggle Admin',
        empty: 'No users yet.',
        errors: {
          loadFailed: 'Failed to load users',
          createFailed: 'Failed to create user',
          updateFailed: 'Failed to update user',
          deleteFailed: 'Failed to delete user',
        },
      },
      systemSettings: {
        title: 'System Settings / Webhook Notifications',
        addWebhook: 'Add webhook',
        webhookUrl: 'Webhook URL',
        secret: 'Secret',
        subscribedEvents: 'Subscribed events',
        saveConfig: 'Save config',
        existingConfigs: 'Existing configs',
        events: 'Events',
        enable: 'Enable',
        disable: 'Disable',
        empty: 'No webhook configs yet.',
        confirmDelete: 'Are you sure to delete this webhook config?',
        errors: { loadFailed: 'Failed to load configuration' },
      },
      aiAssistant: {
        title: 'AI SEO Assistant',
        inputLabel: 'Input page content or SEO copy',
        placeholder: 'Paste main content, title, description, or product copy...',
        submit: 'Analyze with AI',
        loading: 'Analyzing...',
        result: 'Analysis result',
        errors: { requestFailed: 'AI request failed, please check configuration.' },
      },
      errorBoundary: {
        title: 'Something went wrong',
        description: 'Sorry, an unexpected issue occurred. You can retry or go back to home.',
        retry: 'Retry',
        goHome: 'Back to home',
      },
      roiNote: {
        title: 'Attribution notes',
        provider: 'Current source: {{provider}}, mapped to standard revenue field.',
        formula: 'ROI formula: ROI = (Gain - Cost) / Cost; gain includes realized revenue + assisted conversion value.',
        models: {
          linear: 'Linear: spreads assisted conversion value equally across all touchpoints.',
          first_click: 'First Click: highlights first SEO touchpoint contribution.',
          last_click: 'Last Click: highlights SEO contribution before final conversion.',
        },
      },
      aiContent: {
        title: 'AI Content Generation',
        subtitle: 'Generate high-quality SEO articles and social media content with AI',
        tabs: {
          article: 'SEO Article',
          social: 'Social Media',
          analyze: 'SEO Analysis',
        },
        generating: 'Generating...',
        analyzing: 'Analyzing...',
        copy: 'Copy',
        edit: 'Edit',
        save: 'Save',
        tones: {
          professional: 'Professional',
          casual: 'Casual',
          authoritative: 'Authoritative',
          friendly: 'Friendly',
          engaging: 'Engaging',
          humorous: 'Humorous',
          inspirational: 'Inspirational',
        },
        article: {
          settings: 'Article Settings',
          topic: 'Topic / Keyword',
          topicPlaceholder: 'e.g. Best SEO practices in 2025',
          keywords: 'Target Keywords',
          keywordsPlaceholder: 'Separate with commas, e.g. SEO, keyword research, content optimization',
          tone: 'Tone',
          language: 'Language',
          wordCount: 'Word Count',
          words: 'words',
          outline: 'Custom Outline (optional)',
          outlinePlaceholder: 'Enter your desired article outline...',
          generate: 'Generate Article',
          rewritePlaceholder: 'Enter rewrite instructions, e.g. make it more concise, add more examples...',
          rewrite: 'Rewrite',
          editorPlaceholder: 'Generated content will appear here...',
          emptyTitle: 'Ready to create',
          emptySubtitle: 'Configure the settings on the left and click generate',
        },
        social: {
          settings: 'Social Settings',
          topic: 'Content Topic',
          topicPlaceholder: 'e.g. New product launch, industry trends...',
          platform: 'Platform',
          tone: 'Tone',
          count: 'Variants',
          includeHashtags: 'Include Hashtags',
          generate: 'Generate Posts',
          emptyTitle: 'Create social content',
          emptySubtitle: 'Select a platform and topic to generate posts',
        },
        analyze: {
          title: 'SEO Content Analysis',
          placeholder: 'Paste page content, title, description, or product copy for SEO analysis...',
          submit: 'Analyze',
          result: 'Analysis Result',
          emptyTitle: 'Awaiting analysis',
          emptySubtitle: 'Paste your content on the left to get SEO optimization suggestions',
        },
        editor: {
          bold: 'Bold',
          italic: 'Italic',
          underline: 'Underline',
          strikethrough: 'Strikethrough',
          bulletList: 'Bullet List',
          numberedList: 'Numbered List',
          quote: 'Quote',
          link: 'Insert Link',
          clearFormat: 'Clear Formatting',
          markdown: 'Markdown',
          enterUrl: 'Enter URL:',
        },
        errors: {
          generateFailed: 'Content generation failed, please check AI configuration.',
          rewriteFailed: 'Content rewrite failed, please try again.',
          analyzeFailed: 'Analysis failed, please check configuration.',
        },
      },
      keywords: { projectSettings: 'Market Settings', country: 'Country (gl)', language: 'Language (hl)', save: 'Save', locale: 'Locale', market: 'Market' },
      reports: { title: 'Reports', templateEditor: 'Template Editor', templateLocale: 'Template locale' },
      dashboard: { crawlStarted: 'Crawl started!' },
    },
  },
  'zh-CN': {
    translation: {
      common: { loading: '加载中...', create: '创建', cancel: '取消', delete: '删除', yes: '是', no: '否' },
      app: { loading: '加载中...' },
      layout: {
        title: 'SEO 工具', projects: '项目', aiAssistant: 'AI 助手', aiContent: 'AI 内容创作', users: '用户管理', systemSettings: '系统设置', changePassword: '修改密码', twoFactorAuth: '双重认证', logout: '退出登录', language: '语言', theme: '主题', langZhCN: '简体中文', langEnUS: 'English',
      },
      login: {
        title: '登录 SEO Dashboard', email: '邮箱', password: '密码', submit: '登录', loading: '登录中...', forgotPassword: '忘记密码？', errors: { failed: '登录失败，请检查邮箱和密码。' },
      },
      forgotPassword: {
        title: '忘记密码', email: '邮箱', submit: '发送重置链接', loading: '发送中...', backToLogin: '返回登录', errors: { failed: '发送重置邮件失败，请稍后重试。' },
      },
      resetPassword: {
        title: '重置密码', token: '重置令牌', newPassword: '新密码', confirmPassword: '确认新密码', submit: '重置密码', loading: '提交中...', backToLogin: '返回登录',
        errors: { missingToken: '缺少重置令牌。', passwordMismatch: '两次输入的新密码不一致。', failed: '重置密码失败，令牌可能已失效。' },
      },
      changePassword: {
        title: '修改密码', oldPassword: '旧密码', newPassword: '新密码', confirmPassword: '确认新密码', submit: '更新密码', loading: '提交中...',
        errors: { passwordMismatch: '两次输入的新密码不一致。', failed: '修改密码失败，请检查旧密码。' },
      },
      projects: { title: '项目', newProject: '新建项目', createProject: '创建项目', name: '名称', domain: '域名', createdAt: '创建于 {{date}}' },
      users: {
        title: '用户管理', createUser: '新建用户', email: '邮箱', fullName: '姓名', name: '名称', password: '密码', active: '启用', superuser: '超级管理员', actions: '操作',
        toggleActive: '切换启用', toggleAdmin: '切换管理员', empty: '暂无用户。',
        errors: { loadFailed: '加载用户失败', createFailed: '创建用户失败', updateFailed: '更新用户失败', deleteFailed: '删除用户失败' },
      },
      systemSettings: {
        title: '系统设置 / Webhook 通知', addWebhook: '新增 Webhook', webhookUrl: 'Webhook URL', secret: '密钥', subscribedEvents: '订阅事件', saveConfig: '保存配置', existingConfigs: '现有配置', events: '事件', enable: '启用', disable: '禁用', empty: '暂无 webhook 配置。', confirmDelete: '确认删除该 webhook 配置？', errors: { loadFailed: '加载配置失败' },
      },
      aiAssistant: {
        title: 'AI SEO 助手', inputLabel: '输入页面内容或 SEO 文案', placeholder: '粘贴页面主要内容、标题、描述或产品文案...', submit: 'AI 分析', loading: '分析中...', result: '分析结果', errors: { requestFailed: 'AI 请求失败，请检查配置。' },
      },
      errorBoundary: { title: '页面发生错误', description: '抱歉，出现了意外问题。你可以重试，或返回首页继续使用。', retry: '重试', goHome: '返回首页' },
      roiNote: {
        title: '口径说明（避免管理层误读）', provider: '当前数据源：{{provider}}，已统一映射到标准 revenue 字段。', formula: 'ROI 公式：ROI = (收益 - 成本) / 成本；收益包含已实现收入 + 辅助转化折算价值。',
        models: { linear: 'Linear：将辅助转化价值按全触点均摊，适合季度复盘。', first_click: 'First Click：偏向获客阶段，强调 SEO 首次触达的贡献。', last_click: 'Last Click：偏向收口阶段，强调最终成交前的 SEO 贡献。' },
      },
      aiContent: {
        title: 'AI 内容创作',
        subtitle: '利用 AI 生成高质量 SEO 文章与社交媒体内容',
        tabs: {
          article: 'SEO 文章',
          social: '社交媒体',
          analyze: 'SEO 分析',
        },
        generating: '生成中...',
        analyzing: '分析中...',
        copy: '复制',
        edit: '编辑',
        save: '保存',
        tones: {
          professional: '专业',
          casual: '轻松',
          authoritative: '权威',
          friendly: '友好',
          engaging: '引人入胜',
          humorous: '幽默',
          inspirational: '励志',
        },
        article: {
          settings: '文章设置',
          topic: '主题 / 核心关键词',
          topicPlaceholder: '例如：2025年最佳SEO实践',
          keywords: '目标关键词',
          keywordsPlaceholder: '用逗号分隔，例如：SEO, 关键词研究, 内容优化',
          tone: '写作风格',
          language: '语言',
          wordCount: '目标字数',
          words: '字',
          outline: '自定义大纲（可选）',
          outlinePlaceholder: '输入你希望的文章大纲...',
          generate: '生成文章',
          rewritePlaceholder: '输入改写指令，例如：更简洁一些、增加更多示例...',
          rewrite: '改写',
          editorPlaceholder: '生成的内容将在这里显示...',
          emptyTitle: '准备就绪',
          emptySubtitle: '在左侧配置参数并点击生成按钮',
        },
        social: {
          settings: '社交内容设置',
          topic: '内容主题',
          topicPlaceholder: '例如：新产品发布、行业趋势...',
          platform: '平台',
          tone: '语气风格',
          count: '生成数量',
          includeHashtags: '包含标签',
          generate: '生成内容',
          emptyTitle: '创作社交内容',
          emptySubtitle: '选择平台和主题来生成内容',
        },
        analyze: {
          title: 'SEO 内容分析',
          placeholder: '粘贴页面内容、标题、描述或产品文案，进行 SEO 分析...',
          submit: '开始分析',
          result: '分析结果',
          emptyTitle: '等待分析',
          emptySubtitle: '在左侧粘贴内容以获取 SEO 优化建议',
        },
        editor: {
          bold: '加粗',
          italic: '斜体',
          underline: '下划线',
          strikethrough: '删除线',
          bulletList: '无序列表',
          numberedList: '有序列表',
          quote: '引用',
          link: '插入链接',
          clearFormat: '清除格式',
          markdown: 'Markdown',
          enterUrl: '请输入链接地址：',
        },
        errors: {
          generateFailed: '内容生成失败，请检查 AI 配置。',
          rewriteFailed: '内容改写失败，请重试。',
          analyzeFailed: '分析失败，请检查配置。',
        },
      },
      keywords: { projectSettings: '市场设置', country: '国家 (gl)', language: '语言 (hl)', save: '保存', locale: '语言地区', market: '市场' },
      reports: { title: '报告', templateEditor: '模板编辑', templateLocale: '模板语言区域' },
      dashboard: { crawlStarted: '爬取任务已启动！' },
    },
  },
};

i18n.use(initReactI18next).init({
  resources,
  lng: initialLng.startsWith('zh') ? 'zh-CN' : 'en-US',
  fallbackLng,
  interpolation: { escapeValue: false },
});

i18n.on('languageChanged', (lng) => {
  localStorage.setItem(LANGUAGE_STORAGE_KEY, lng);
});

export default i18n;
